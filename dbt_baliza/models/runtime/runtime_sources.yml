version: 2

sources:
  - name: runtime
    description: "Runtime tables populated by Python extraction code"
    schema: main_runtime
    tables:
      - name: task_claims
        description: "Atomic task claiming for concurrent worker coordination"
        columns:
          - name: claim_id
            description: "UUID primary key"
            tests:
              - unique
              - not_null
          - name: task_id
            description: "Foreign key to task_plan"
            tests:
              - not_null
          - name: claimed_at
            description: "Claim timestamp"
            tests:
              - not_null
          - name: expires_at
            description: "Claim expiration (prevents zombie claims)"
            tests:
              - not_null
          - name: worker_id
            description: "Worker identifier"
            tests:
              - not_null
          - name: status
            description: "Claim status"
            tests:
              - accepted_values:
                  values: ['CLAIMED', 'EXECUTING', 'COMPLETED', 'FAILED']

      - name: task_results
        description: "Execution results streamed from Python code"
        columns:
          - name: result_id
            description: "UUID primary key"
            tests:
              - unique
              - not_null
          - name: task_id
            description: "Foreign key to task_plan"
            tests:
              - not_null
          - name: request_id
            description: "Foreign key to pncp_requests"
          - name: page_number
            description: "API response page number"
          - name: records_extracted
            description: "Records in this page"
          - name: completed_at
            description: "Completion timestamp"
            tests:
              - not_null