version: 2

models:
  - name: task_claims
    description: "Atomic task claiming for concurrent worker safety"
    columns:
      - name: claim_id
        description: "Unique claim identifier (UUID)"
        tests:
          - unique
          - not_null
      - name: task_id
        description: "Reference to task_plan.task_id"
        tests:
          - not_null
          - relationships:
              to: ref('task_plan')
              field: task_id
      - name: claimed_at
        description: "Timestamp when task was claimed"
        tests:
          - not_null
      - name: expires_at
        description: "Claim expiration timestamp (prevents zombie claims)"
        tests:
          - not_null
      - name: worker_id
        description: "Identifier of worker that claimed this task"
        tests:
          - not_null
      - name: status
        description: "Claim status: CLAIMED, EXECUTING, COMPLETED, FAILED"
        tests:
          - accepted_values:
              values: ['CLAIMED', 'EXECUTING', 'COMPLETED', 'FAILED']

  - name: task_results
    description: "Granular execution results from PNCP API calls"
    columns:
      - name: result_id
        description: "Unique result identifier (UUID)"
        tests:
          - unique
          - not_null
      - name: task_id
        description: "Reference to task_plan.task_id"
        tests:
          - not_null
          - relationships:
              to: ref('task_plan')
              field: task_id
      - name: request_id
        description: "Reference to pncp_requests.id for traceability"
      - name: page_number
        description: "Page number in paginated API response"
      - name: records_extracted
        description: "Number of records returned in this page"
      - name: completed_at
        description: "Timestamp when this result was recorded"
        tests:
          - not_null